mashupApp.config(["$provide",function(a){a.decorator("$log",["$delegate","logService",function(a,b){return b(a)}])}]),mashupApp.factory("logService",["$filter","sessionService","utility",function(a,b,c){"use strict";return function(d){var e=1,f=0,g={stores:[{name:"log",keyPath:"logId",autoIncrement:!1},{name:"heartbeat",keyPath:"logId",autoIncrement:!1}]},h=new ydn.db.Storage("logServiceDB",g),i=!1;h.onReady(function(){i=!0,console.log("logServiceDB is ready. [logService]")}),h.addEventListener("error",function(a){var b=a.getError();console.log("connection failed with "+b.name)});var j=function(b,d){var g=(new Date).getTime(),h=c.localMilToUtcMil(g),i=a("date")(g,"short"),j=a("date")(h,"short"),k={msg:b[f],logId:h,dateTimeLocal:i,dateTimeUtc:j,logType:d,transmitted:!1};if(b.length>1)for(var l in b[e])b[e].hasOwnProperty(l)&&(k[l]=b[e][l]);return k},k=function(a,b){!function c(){if(i){if(angular.isString(a[f])){var d=j(a,b),e=d.subject;switch(e){case"Perf":break;case"HeartBeatFail":case"CodeBlueMonitor":h.put({name:"heartbeat"},d);break;case"Debug":break;case"Error":}h.put({name:"log"},d)}}else setTimeout(c,500)}()};return function(){var a=null,d=null,e=b.envSession();"desktop"===e.deviceType?(a=72e5,d=6048e5):(a=18e5,d=1728e5),e.batteryLevel&&e.batteryLevel<=30&&(a=4*a,d=4*d),setInterval(function(){!function a(){if(i){var e=c.localMilToUtcMil((new Date).getTime())-d,f=ydn.db.KeyRange.upperBound(e,!0),g=c.getLogObject("logManagement:Truncate","Mashup.UI.Core","logService","anonymous:setInterval",null,b);h.remove("log",f).done(function(a){g.status=!0,g.count=a,k(["Truncating old [log] records.",g],"log"),console.log(["Truncating old [log] records.",g])}).fail(function(a){throw g.status=!1,k(["Truncating old [log] records. (failed)",g],"log"),console.log(["Truncating old [log] records.",g]),a})}else setTimeout(a,500)}()},a,0,!1)}(),{log:function(){d.log(arguments[f]);try{k(arguments,"log")}catch(a){}},info:function(){d.info(arguments[f]);try{k(arguments,"info")}catch(a){}},error:function(){d.error(arguments[f]);try{k(arguments,"error")}catch(a){}},warn:function(){d.warn(arguments[f]);try{k(arguments,"warn")}catch(a){}}}}}]);
//# sourceMappingURL=log.service.min.js.map